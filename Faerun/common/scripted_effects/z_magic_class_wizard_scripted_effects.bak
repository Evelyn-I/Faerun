z_wiz_setup = { 
	if = {
		limit = { 
			z_wizard = yes
		}
		z_wizlvl_calc = yes
		set_variable = { which = "magical_resistance" value = 0 }
		set_variable = { which = "magical_penetration" value = 0 }
		set_variable = { which = "magic_dispel" value = 0 }
		change_variable = { which = "magic_dispel" which = "wizlvl"}
		change_variable = { which = "magical_resistance" which = "wizlvl" }
		change_variable = { which = "magical_penetration" which = "wizlvl" }
		set_variable = { which = "wcl" which = "wizlvl"}
		set_variable = { which = "wcl_sp" which = "wcl" }
	}
	z_itemization = yes
}

#Wizard
z_calc_spell_slots_wizard = { 
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "0"}
		}
		set_variable = { which = "ss_1_m_wiz" value = "1"}
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "5"}
		}
		set_variable = { which = "ss_2_m_wiz" value = "1"}
		set_variable = { which = "ss_1_m_wiz" value = "2"}
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "10"}
		}
		set_variable = { which = "ss_3_m_wiz" value = "1"}
		set_variable = { which = "ss_2_m_wiz" value = "2"}
		set_variable = { which = "ss_1_m_wiz" value = "3"}
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "15"}
		}
		set_variable = { which = "ss_4_m_wiz" value = "1"}
		set_variable = { which = "ss_3_m_wiz" value = "2"}
		set_variable = { which = "ss_2_m_wiz" value = "3"}
		set_variable = { which = "ss_1_m_wiz" value = "4"}
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "20"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "1"}
		set_variable = { which = "ss_4_m_wiz" value = "2"}
		set_variable = { which = "ss_3_m_wiz" value = "3"}
		set_variable = { which = "ss_2_m_wiz" value = "4"}
		set_variable = { which = "ss_1_m_wiz" value = "5"}
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "25"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "2"}
		set_variable = { which = "ss_4_m_wiz" value = "3"}
		set_variable = { which = "ss_3_m_wiz" value = "4"}
		set_variable = { which = "ss_2_m_wiz" value = "5"}
		set_variable = { which = "ss_1_m_wiz" value = "6"}		
	}	
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "30"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "3"}
		set_variable = { which = "ss_4_m_wiz" value = "4"}
		set_variable = { which = "ss_3_m_wiz" value = "5"}
		set_variable = { which = "ss_2_m_wiz" value = "6"}
		set_variable = { which = "ss_1_m_wiz" value = "7"}	
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "35"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "4"}
		set_variable = { which = "ss_4_m_wiz" value = "5"}
		set_variable = { which = "ss_3_m_wiz" value = "6"}
		set_variable = { which = "ss_2_m_wiz" value = "7"}
		set_variable = { which = "ss_1_m_wiz" value = "8"}	
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "40"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "5"}
		set_variable = { which = "ss_4_m_wiz" value = "6"}
		set_variable = { which = "ss_3_m_wiz" value = "7"}
		set_variable = { which = "ss_2_m_wiz" value = "8"}
		set_variable = { which = "ss_1_m_wiz" value = "9"}	
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "45"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "6"}
		set_variable = { which = "ss_4_m_wiz" value = "7"}
		set_variable = { which = "ss_3_m_wiz" value = "8"}
		set_variable = { which = "ss_2_m_wiz" value = "9"}
		set_variable = { which = "ss_1_m_wiz" value = "10"}	
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "50"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "7"}
		set_variable = { which = "ss_4_m_wiz" value = "8"}
		set_variable = { which = "ss_3_m_wiz" value = "9"}
		set_variable = { which = "ss_2_m_wiz" value = "10"}
		set_variable = { which = "ss_1_m_wiz" value = "11"}	
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "55"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "8"}
		set_variable = { which = "ss_4_m_wiz" value = "9"}
		set_variable = { which = "ss_3_m_wiz" value = "10"}
		set_variable = { which = "ss_2_m_wiz" value = "11"}
		set_variable = { which = "ss_1_m_wiz" value = "12"}	
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "60"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "9"}
		set_variable = { which = "ss_4_m_wiz" value = "10"}
		set_variable = { which = "ss_3_m_wiz" value = "11"}
		set_variable = { which = "ss_2_m_wiz" value = "12"}
		set_variable = { which = "ss_1_m_wiz" value = "12"}	
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "65"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "10"}
		set_variable = { which = "ss_4_m_wiz" value = "11"}
		set_variable = { which = "ss_3_m_wiz" value = "12"}
		set_variable = { which = "ss_2_m_wiz" value = "12"}
		set_variable = { which = "ss_1_m_wiz" value = "12"}	
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "70"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "11"}
		set_variable = { which = "ss_4_m_wiz" value = "11"}
		set_variable = { which = "ss_3_m_wiz" value = "12"}
		set_variable = { which = "ss_2_m_wiz" value = "12"}
		set_variable = { which = "ss_1_m_wiz" value = "12"}	
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "75"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "11"}
		set_variable = { which = "ss_4_m_wiz" value = "12"}
		set_variable = { which = "ss_3_m_wiz" value = "12"}
		set_variable = { which = "ss_2_m_wiz" value = "12"}
		set_variable = { which = "ss_1_m_wiz" value = "12"}	
	}
	if = { 
		limit = { 
			check_variable = { which = "wizlvl" value = "80"}
		}
		set_variable = { which = "ss_5_m_wiz" value = "12"}
		set_variable = { which = "ss_4_m_wiz" value = "12"}
		set_variable = { which = "ss_3_m_wiz" value = "12"}
		set_variable = { which = "ss_2_m_wiz" value = "12"}
		set_variable = { which = "ss_1_m_wiz" value = "12"}	
	}
	if = { 
		limit = { 
			trait = magister
		}
		if = { 
			limit = {
				check_variable = {which ="ss_1_m_wiz" value  = "1"}
			}
			multiply_variable = {which ="ss_1_m_wiz" value  = "2"} 
		}
		if = { 
			limit = {
				check_variable = {which ="ss_2_m_wiz" value  = "1"}
			}
			multiply_variable = {which ="ss_2_m_wiz" value  = "2"} 
		}
		if = { 
			limit = {
				check_variable = {which ="ss_3_m_wiz" value  = "1"}
			}
			multiply_variable = {which ="ss_3_m_wiz" value  = "2"} 
		}
		if = { 
			limit = {
				check_variable = {which ="ss_4_m_wiz" value  = "1"}
			}
			multiply_variable = {which ="ss_4_m_wiz" value  = "2"} 
		}
		if = { 
			limit = {
				check_variable = {which ="ss_5_m_wiz" value  = "1"}
			}
			multiply_variable = {which ="ss_5_m_wiz" value  = "2"} 
		}
	}
}

z_spell_slots_refresh_wizard = { 
	z_calc_spell_slots_wizard = yes
	if = {
		limit = {
			check_variable = {which ="ss_1_m_wiz" value  = "1"}
		}
		set_variable = { which = "ss_1_wiz" which = "ss_1_m_wiz"}
	}
	if = {
		limit = {
			check_variable = {which ="ss_2_m_wiz" value  = "1"}
		}
		set_variable = { which = "ss_2_wiz" which = "ss_2_m_wiz"}
	}
	if = {
		limit = {
			check_variable = {which ="ss_3_m_wiz" value  = "1"}
		}
		set_variable = { which = "ss_3_wiz" which = "ss_3_m_wiz"}
	}
	if = {
		limit = {
			check_variable = {which ="ss_4_m_wiz" value  = "1"}
		}
		set_variable = { which = "ss_4_wiz" which = "ss_4_m_wiz"}
	}
	if = {
		limit = {
			check_variable = {which ="ss_5_m_wiz" value  = "1"}
		}
		set_variable = { which = "ss_5_wiz" which = "ss_5_m_wiz"}
	}
}

wizard_spell_prep_clr_all = { 
	wizard_spell_prep_clr_lvl_1 = yes
	wizard_spell_prep_clr_lvl_2 = yes
	wizard_spell_prep_clr_lvl_3 = yes
	wizard_spell_prep_clr_lvl_4 = yes
	wizard_spell_prep_clr_lvl_5 = yes
}

wizard_spell_prep_clr_lvl_1 = { 
	clr_character_flag = mem_wiz_magmis
	clr_character_flag = mem_wiz_magbar
	clr_character_flag = mem_wiz_burbla
}
wizard_spell_prep_clr_lvl_2 = { 
	clr_character_flag = mem_wiz_thubol
	clr_character_flag = mem_wiz_firbal
	clr_character_flag = mem_wiz_icesto
}
wizard_spell_prep_clr_lvl_3 = { 
	clr_character_flag = mem_wiz_thubol
	clr_character_flag = mem_wiz_firbal
	clr_character_flag = mem_wiz_icesto
}
wizard_spell_prep_clr_lvl_4 = { 
	clr_character_flag = mem_wiz_thubol
	clr_character_flag = mem_wiz_firbal
	clr_character_flag = mem_wiz_icesto
}
wizard_spell_prep_clr_lvl_5 = { 
	clr_character_flag = mem_wiz_thubol
	clr_character_flag = mem_wiz_firbal
	clr_character_flag = mem_wiz_icesto
}
wizard_spell_preparation_random_lvl_1 = { 
	random_list = { 
		1 = {
			set_character_flag = mem_wiz_magmis
		}
		1 = {
			set_character_flag = mem_wiz_magbar
		}
		1 = {
			set_character_flag = mem_wiz_burbla
		}
	}
}
wizard_spell_preparation_random_lvl_2 = { 
	random_list = { 
		1 = {
			set_character_flag = mem_wiz_thubol
		}
		1 = {
			set_character_flag = mem_wiz_firbal
		}
		1 = {
			set_character_flag = mem_wiz_icesto
		}
	}
}

#Wizard Spell preparation
wizard_spell_preparation_menu_setup = { 
	set_variable = { which  = "local_action_nr" value = 0 }
    set_variable = { which = "local_action_picked" value = 1 }
    #Actions below this point are kept within the special action menu  
    if = { 
        limit = { 
            z_wizard = yes
        }  
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_lvl_1" which = "local_action_nr" } 
    }

    if = { 
        limit = { 
             event_target:magic_caster = { 
            	z_wizard = yes
            	check_variable = { which = "wizlvl" value = "5"}
            }
        }  
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_lvl_2" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	check_variable = { which = "wizlvl" value = "10"}
            }
        }  
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_lvl_3" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	check_variable = { which = "wizlvl" value = "15"}
            }
        }  
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_lvl_4" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	check_variable = { which = "wizlvl" value = "20"}
            }
        }  
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_lvl_5" which = "local_action_nr" } 
    }             
    change_variable = { which = "local_action_nr" value = 1 } 
    set_variable = { which = "local_d_action_previous_menu" which = "local_action_nr" }
}

wizard_spell_preparation_menu_lvl_1_combat_setup = { 
    set_variable = { which  = "local_action_nr" value = 0 }
    set_variable = { which = "local_action_picked" value = 1 }
    #Actions below this point are kept within the special action menu  
    if = { 
        limit = {
        	event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_magmis
            }
        }  
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_magic_missile" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_magbar
            }
        } 
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_magic_barrier" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_burbla
            }
        } 
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_burning_blade" which = "local_action_nr" } 
    }
    change_variable = { which = "local_action_nr" value = 1 } 
    set_variable = { which = "local_d_action_previous_menu" which = "local_action_nr" }
}
wizard_spell_preparation_menu_lvl_2_combat_setup = { 
    set_variable = { which  = "local_action_nr" value = 0 }
    set_variable = { which = "local_action_picked" value = 1 }
    #Actions below this point are kept within the special action menu  
    if = { 
        limit = {
        	event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_thubol
            }
        }  
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_thunder_bolt" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_firbal
            }
        } 
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_fire_ball" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_icesto
            }
        } 
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_ice_storm" which = "local_action_nr" } 
    }
    change_variable = { which = "local_action_nr" value = 1 } 
    set_variable = { which = "local_d_action_previous_menu" which = "local_action_nr" }
}
wizard_spell_preparation_menu_lvl_3_combat_setup = { 
    set_variable = { which  = "local_action_nr" value = 0 }
    set_variable = { which = "local_action_picked" value = 1 }
    #Actions below this point are kept within the special action menu  
    if = { 
        limit = {
        	event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_isamis
            }
        }  
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_issacs_greater_magic_missile" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_antshe
            }
        } 
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_anti_magic_shell" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_aniund
            }
        } 
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_animate_undead" which = "local_action_nr" } 
    }
    change_variable = { which = "local_action_nr" value = 1 } 
    set_variable = { which = "local_d_action_previous_menu" which = "local_action_nr" }
}
wizard_spell_preparation_menu_lvl_4_combat_setup = { 
    set_variable = { which  = "local_action_nr" value = 0 }
    set_variable = { which = "local_action_picked" value = 1 }
    #Actions below this point are kept within the special action menu  
    if = { 
        limit = {
        	event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_walfro
            }
        }  
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_wall_of_frost" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_chalig
            }
        } 
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_chain_lightning" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_earqua
            }
        } 
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_earthquake" which = "local_action_nr" } 
    }
    change_variable = { which = "local_action_nr" value = 1 } 
    set_variable = { which = "local_d_action_previous_menu" which = "local_action_nr" }
}
wizard_spell_preparation_menu_lvl_5_combat_setup = { 
    set_variable = { which  = "local_action_nr" value = 0 }
    set_variable = { which = "local_action_picked" value = 1 }
    #Actions below this point are kept within the special action menu  
    if = { 
        limit = {
        	event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_vortex
            }
        }  
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_vortex" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_precog
            }
        } 
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_precognition" which = "local_action_nr" } 
    }
    if = { 
        limit = { 
            event_target:magic_caster = { 
            	z_wizard = yes
            	has_character_flag = wiz_metsho
            }
        } 
        change_variable = { which = "local_action_nr" value = 1 } 
        set_variable = { which = "local_m_action_wiz_meteor_shower" which = "local_action_nr" } 
    }
    change_variable = { which = "local_action_nr" value = 1 } 
    set_variable = { which = "local_d_action_previous_menu" which = "local_action_nr" }
}